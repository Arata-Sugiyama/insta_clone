{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nconst apiUrlPost = `${process.env.REACT_APP_DEV_API_URL}api/post/`;\nconst apiUrlComment = `${process.env.REACT_APP_DEV_API_URL}api/comment/`;\nexport const fetchAsyncGetPosts = createAsyncThunk(\"post/get\", async () => {\n  const res = await axios.get(apiUrlPost, {\n    headers: {\n      Authorization: `JWT ${localStorage.localJWT}`\n    }\n  });\n  return res.data;\n});\nexport const fetchAsyncNewPost = createAsyncThunk(\"post/post\", async newPost => {\n  const uploadData = new FormData();\n  uploadData.append(\"title\", newPost.title);\n  newPost.img && uploadData.append(\"img\", newPost.img, newPost.img.name);\n  const res = await axios.post(apiUrlPost, uploadData, {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `JWT ${localStorage.localJWT}`\n    }\n  });\n  return res.data;\n});\nexport const fetchAsyncPatchLiked = createAsyncThunk(\"post/patch\", async liked => {\n  const currentLiked = liked.current;\n  const uploadData = new FormData();\n  let isOverlapped = false;\n  currentLiked.forEach(current => {\n    if (current === liked.new) {\n      isOverlapped = true;\n    } else {\n      uploadData.append(\"liked\", String(current));\n    }\n  });\n\n  if (!isOverlapped) {\n    uploadData.append(\"liked\", String(liked.new));\n  } else if (currentLiked.length === 1) {\n    uploadData.append(\"title\", liked.title);\n    const res = await axios.put(`${apiUrlPost}${liked.id}/`, uploadData, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `JWT ${localStorage.localJWT}`\n      }\n    });\n    return res.data;\n  }\n\n  const res = await axios.patch(`${apiUrlPost}${liked.id}/`, uploadData, {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `JWT ${localStorage.localJWT}`\n    }\n  });\n  return res.data;\n});\nexport const fetchAsyncGetComments = createAsyncThunk(\"comment/get\", async () => {\n  const res = await axios.get(apiUrlComment, {\n    headers: {\n      Authorization: `JWT ${localStorage.localJWT}`\n    }\n  });\n  return res.data;\n});\nexport const fetchAsyncPostComment = createAsyncThunk(\"comment/post\", async comment => {\n  const res = await axios.post(apiUrlComment, comment, {\n    headers: {\n      Authorization: `JWT ${localStorage.localJWT}`\n    }\n  });\n  return res.data;\n});\nexport const postSlice = createSlice({\n  name: \"post\",\n  initialState: {\n    isLoadingPost: false,\n    openNewPost: false,\n    posts: [{\n      id: 0,\n      title: \"\",\n      userPost: 0,\n      created_on: \"\",\n      img: \"\",\n      liked: [0]\n    }],\n    comments: [{\n      id: 0,\n      text: \"\",\n      userComment: 0,\n      post: 0\n    }]\n  },\n  reducers: {\n    fetchPostStart(state) {\n      state.isLoadingPost = true;\n    },\n\n    fetchPostEnd(state) {\n      state.isLoadingPost = false;\n    },\n\n    setOpenNewPost(state) {\n      state.openNewPost = true;\n    },\n\n    resetOpenNewPost(state) {\n      state.openNewPost = false;\n    }\n\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchAsyncGetPosts.fulfilled, (state, action) => {\n      return { ...state,\n        posts: action.payload\n      };\n    });\n    builder.addCase(fetchAsyncNewPost.fulfilled, (state, action) => {\n      return { ...state,\n        posts: [...state.posts, action.payload]\n      };\n    });\n    builder.addCase(fetchAsyncGetComments.fulfilled, (state, action) => {\n      return { ...state,\n        comments: action.payload\n      };\n    });\n    builder.addCase(fetchAsyncPostComment.fulfilled, (state, action) => {\n      return { ...state,\n        comments: [...state.comments, action.payload]\n      };\n    });\n    builder.addCase(fetchAsyncPatchLiked.fulfilled, (state, action) => {\n      return { ...state,\n        posts: state.posts.map(post => post.id === action.payload.id ? action.payload : post)\n      };\n    });\n  }\n});\nexport const {\n  fetchPostStart,\n  fetchPostEnd,\n  setOpenNewPost,\n  resetOpenNewPost\n} = postSlice.actions;\nexport const selectIsLoadingPost = state => state.post.isLoadingPost;\nexport const selectOpenNewPost = state => state.post.openNewPost;\nexport const selectPosts = state => state.post.posts;\nexport const selectComments = state => state.post.comments;\nexport default postSlice.reducer;","map":{"version":3,"sources":["/Users/sugiyamaarata/Documents/insta_app/react_insta/src/features/post/postSlice.ts"],"names":["createSlice","createAsyncThunk","axios","apiUrlPost","process","env","REACT_APP_DEV_API_URL","apiUrlComment","fetchAsyncGetPosts","res","get","headers","Authorization","localStorage","localJWT","data","fetchAsyncNewPost","newPost","uploadData","FormData","append","title","img","name","post","fetchAsyncPatchLiked","liked","currentLiked","current","isOverlapped","forEach","new","String","length","put","id","patch","fetchAsyncGetComments","fetchAsyncPostComment","comment","postSlice","initialState","isLoadingPost","openNewPost","posts","userPost","created_on","comments","text","userComment","reducers","fetchPostStart","state","fetchPostEnd","setOpenNewPost","resetOpenNewPost","extraReducers","builder","addCase","fulfilled","action","payload","map","actions","selectIsLoadingPost","selectOpenNewPost","selectPosts","selectComments","reducer"],"mappings":"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","sourcesContent":["import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport { RootState } from \"../../app/store\";\nimport axios from \"axios\";\nimport { PROPS_NEWPOST, PROPS_LIKED, PROPS_COMMENT } from \"../types\";\n\nconst apiUrlPost = `${process.env.REACT_APP_DEV_API_URL}api/post/`;\nconst apiUrlComment = `${process.env.REACT_APP_DEV_API_URL}api/comment/`;\n\nexport const fetchAsyncGetPosts = createAsyncThunk(\"post/get\", async () => {\n  const res = await axios.get(apiUrlPost, {\n    headers: {\n      Authorization: `JWT ${localStorage.localJWT}`,\n    },\n  });\n  return res.data;\n});\n\nexport const fetchAsyncNewPost = createAsyncThunk(\n  \"post/post\",\n  async (newPost: PROPS_NEWPOST) => {\n    const uploadData = new FormData();\n    uploadData.append(\"title\", newPost.title);\n    newPost.img && uploadData.append(\"img\", newPost.img, newPost.img.name);\n    const res = await axios.post(apiUrlPost, uploadData, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `JWT ${localStorage.localJWT}`,\n      },\n    });\n    return res.data;\n  }\n);\n\nexport const fetchAsyncPatchLiked = createAsyncThunk(\n  \"post/patch\",\n  async (liked: PROPS_LIKED) => {\n    const currentLiked = liked.current;\n    const uploadData = new FormData();\n\n    let isOverlapped = false;\n    currentLiked.forEach((current) => {\n      if (current === liked.new) {\n        isOverlapped = true;\n      } else {\n        uploadData.append(\"liked\", String(current));\n      }\n    });\n\n    if (!isOverlapped) {\n      uploadData.append(\"liked\", String(liked.new));\n    } else if (currentLiked.length === 1) {\n      uploadData.append(\"title\", liked.title);\n      const res = await axios.put(`${apiUrlPost}${liked.id}/`, uploadData, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `JWT ${localStorage.localJWT}`,\n        },\n      });\n      return res.data;\n    }\n    const res = await axios.patch(`${apiUrlPost}${liked.id}/`, uploadData, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `JWT ${localStorage.localJWT}`,\n      },\n    });\n    return res.data;\n  }\n);\n\nexport const fetchAsyncGetComments = createAsyncThunk(\n  \"comment/get\",\n  async () => {\n    const res = await axios.get(apiUrlComment, {\n      headers: {\n        Authorization: `JWT ${localStorage.localJWT}`,\n      },\n    });\n    return res.data;\n  }\n);\n\nexport const fetchAsyncPostComment = createAsyncThunk(\n  \"comment/post\",\n  async (comment: PROPS_COMMENT) => {\n    const res = await axios.post(apiUrlComment, comment, {\n      headers: {\n        Authorization: `JWT ${localStorage.localJWT}`,\n      },\n    });\n    return res.data;\n  }\n);\n\nexport const postSlice = createSlice({\n  name: \"post\",\n  initialState: {\n    isLoadingPost: false,\n    openNewPost: false,\n    posts: [\n      {\n        id: 0,\n        title: \"\",\n        userPost: 0,\n        created_on: \"\",\n        img: \"\",\n        liked: [0],\n      },\n    ],\n    comments: [\n      {\n        id: 0,\n        text: \"\",\n        userComment: 0,\n        post: 0,\n      },\n    ],\n  },\n  reducers: {\n    fetchPostStart(state) {\n      state.isLoadingPost = true;\n    },\n    fetchPostEnd(state) {\n      state.isLoadingPost = false;\n    },\n    setOpenNewPost(state) {\n      state.openNewPost = true;\n    },\n    resetOpenNewPost(state) {\n      state.openNewPost = false;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(fetchAsyncGetPosts.fulfilled, (state, action) => {\n      return {\n        ...state,\n        posts: action.payload,\n      };\n    });\n    builder.addCase(fetchAsyncNewPost.fulfilled, (state, action) => {\n      return {\n        ...state,\n        posts: [...state.posts, action.payload],\n      };\n    });\n    builder.addCase(fetchAsyncGetComments.fulfilled, (state, action) => {\n      return {\n        ...state,\n        comments: action.payload,\n      };\n    });\n    builder.addCase(fetchAsyncPostComment.fulfilled, (state, action) => {\n      return {\n        ...state,\n        comments: [...state.comments, action.payload],\n      };\n    });\n    builder.addCase(fetchAsyncPatchLiked.fulfilled, (state, action) => {\n      return {\n        ...state,\n        posts: state.posts.map((post) =>\n          post.id === action.payload.id ? action.payload : post\n        ),\n      };\n    });\n  },\n});\n\nexport const {\n  fetchPostStart,\n  fetchPostEnd,\n  setOpenNewPost,\n  resetOpenNewPost,\n} = postSlice.actions;\n\nexport const selectIsLoadingPost = (state: RootState) =>\n  state.post.isLoadingPost;\nexport const selectOpenNewPost = (state: RootState) => state.post.openNewPost;\nexport const selectPosts = (state: RootState) => state.post.posts;\nexport const selectComments = (state: RootState) => state.post.comments;\n\nexport default postSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}